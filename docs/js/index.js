import{getMatrix}from"./modules/getMatrix.js";import{findCoordinatesByNumber}from"./modules/findCoordinatesByNumber.js";import{isValidForSwap}from"./modules/isValidForSwap.js";import{isWon}from"./modules/isWon.js";import{addWonClass}from"./modules/addWonClass.js";import{setPositionItems}from"./modules/setPositionItems.js";const gameNode=document.querySelector(".game"),containerNode=document.querySelector(".puzzle"),itemNodes=Array.from(containerNode.querySelectorAll(".item")),resetBtn=document.getElementById("reset"),shuffleBtn=document.getElementById("shuffle"),GAME_CANVAS_SIZE=itemNodes.length,countItems=GAME_CANVAS_SIZE,blankNumber=GAME_CANVAS_SIZE;let matrixSize=4;itemNodes[countItems-1].style.display="none";let matrix=getMatrix(itemNodes.map(e=>Number(e.dataset.matrixId)),matrixSize);setPositionItems(matrix,itemNodes);const maxShuffleCount=100;let timer,shuffled=!1;const shuffledClassName="gameShuffle";shuffleBtn.addEventListener("click",()=>{let e=0;clearInterval(timer),shuffled||(timer=setInterval(()=>{randomSwap(matrix),setPositionItems(matrix,itemNodes),gameNode.classList.add(shuffledClassName),shuffled=!0,e+=1,e>=maxShuffleCount&&(clearInterval(timer),gameNode.classList.remove(shuffledClassName),shuffled=!1)},60))}),resetBtn.addEventListener("click",()=>{var e=getMatrix(matrix.flat().sort((e,t)=>e-t),matrixSize);matrix=[...e],setPositionItems(matrix,itemNodes)});let blokedCoords=null;function randomSwap(e){var t=findCoordinatesByNumber(blankNumber,e),o=findValidCoords(t,e,blokedCoords);swap(t,o[Math.floor(Math.random()*o.length)],e),blokedCoords=t}function findValidCoords(o,s,r){const a=[];for(let t=0;t<s.length;t++)for(let e=0;e<s[t].length;e++)isValidForSwap({x:e,y:t},o)&&(r&&r.x===e&&r.y===t||a.push({x:e,y:t}));return a}function swap(e,t,o){var s=o[e.y][e.x];o[e.y][e.x]=o[t.y][t.x],o[t.y][t.x]=s,isWon(o)&&addWonClass(containerNode,"puzzleWon")}containerNode.addEventListener("click",e=>{var t=e.target.closest("button");t&&(e=Number(t.dataset.matrixId),t=findCoordinatesByNumber(e,matrix),e=findCoordinatesByNumber(blankNumber,matrix),isValidForSwap(t,e)&&(swap(e,t,matrix),setPositionItems(matrix,itemNodes)))}),window.addEventListener("keydown",e=>{if(!shuffled&&e.key.includes("Arrow")){var t=findCoordinatesByNumber(blankNumber,matrix);const s={x:t.x,y:t.y};var o=e.key.split("Arrow")[1].toLowerCase(),e=matrix.length;switch(o){case"up":s.y+=1;break;case"down":--s.y;break;case"left":s.x+=1;break;case"right":--s.x}s.y>=e||s.y<0||s.x>=e||s.x<0||(swap(t,s,matrix),setPositionItems(matrix,itemNodes))}});